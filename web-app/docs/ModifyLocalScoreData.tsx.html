

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Web-App Documentation ModifyLocalScoreData.tsx</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Localshirt Web-app Documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/ErwanSimonetti/LocalShirto"
                        >
                            Github
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://www.notion.so/0d4551e8e0bf46d0949377e09a75ea0b?v=495390718b594a409ffc0a7b0d46505d"
                        >
                            Notion
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://linear.app/localshirt/team/SHIRT/all"
                        >
                            Linear
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="RadioButtonGroup.html">RadioButtonGroup</a></li></ul><h3>Components</h3><ul><li><a href="Button.html">Button</a></li><li><a href="RadioInput.html">RadioInput</a></li><li><a href="TextInput.html">TextInput</a></li></ul></div><div class="category"><h2>Pages</h2><h3>Components</h3><ul><li><a href="EmailPage.html">EmailPage</a></li><li><a href="module-ContactPage.html">ContactPage</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>ModifyLocalScoreData.tsx</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Select from 'react-select'
import {createRef, RefObject, useEffect, useState} from "react";
import {DocumentNode, gql, useQuery} from "@apollo/client";
import client from "./graphqlApollo";
import {useCookies} from "react-cookie";

type QuestionContent = {
    id: number;
    tag: string;
    content: string;
    criteria_target: string;
    criteria_application: string,
    user_response_type: string,
    factor: number,
    minimize: boolean
};
type SelectedContent = { value: string, label: string, dbKeys: string[] } | undefined;

/**
 * @class
 * @classdesc The class does a group of Radio Buttons
 */
class RadioButtonGroup {
    private name: string;
    private values: string[];
    private selected: string;

    constructor(name: string, values: string[]) {
        this.name = name;
        this.values = values;
        this.selected = '';
    }

    getSelected(): string {
        return this.selected;
    }

    getName(): string {
        return this.name;
    }

    getRadioButtons(): JSX.Element {
        return &lt;> {this.values.map(value => {
            return &lt;input className='localshirt-radio-button' type={'radio'} name={this.name + '-' + value} value={value}
                          onChange={() => this.selected = value} content={value}/>
        })} &lt;/>
    }
}

const setUpQuestionTable = (): void => {
    const [cookies] = useCookies(['token']);

    let qr = gql(`
    query {
      updateQuestionByTag(
        tag: "tag"
        criteria_target: "all"
        criteria_application: ""
        user_response_type: "text",
        content: "What is its tag ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });

    qr = gql(`
    query {
      updateQuestionByTag(
        tag: "criteria_target"
        criteria_target: "question"
        criteria_application: ""
        user_response_type: "text",
        content: "Which criteria does that target ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });

    qr = gql(`
    query {
      updateQuestionByTag(
        tag: "criteria_application"
        criteria_target: "question"
        criteria_application: ""
        user_response_type: "text",
        content: "What is it classification type ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });

    qr = gql(`
    query {
      updateQuestionByTag(
        tag: "user_response_type"
        criteria_target: "question"
        criteria_application: ""
        user_response_type: "text",
        content: "In which form should the user respond ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });

    qr = gql(`
    query {
      updateQuestionByTag(
        tag: "content"
        criteria_target: "question"
        criteria_application: ""
        user_response_type: "text",
        content: "What should be the question ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });

    qr = gql(`
    query {
      updateQuestionByTag(
        tag: "factor"
        criteria_target: "question"
        criteria_application: ""
        user_response_type: "range",
        content: "What is its factor in the notation ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });

    qr = gql(`
    query {
      updateQuestionByTag(
        tag: "minimize"
        criteria_target: "question"
        criteria_application: ""
        user_response_type: "boolean",
        content: "Is the smaller value the best one ?",
        factor: 0
        minimize: true 
      ) {status, content}
    }`);
    client.query({
        query: qr, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }
    });
}

function ModifyLocalScoreDataPage() {
    const [cookies] = useCookies(['token']);
    const [options] = useState&lt;{ value: string, label: string, dbKeys: string[] }[]>([{
        value: 'question',
        label: "question",
        dbKeys: ['tag', 'content', 'criteria_target', 'criteria_application', 'user_response_type', 'factor', 'minimize']
    }]);
    const htmlObjectsRef: { ref: RefObject&lt;HTMLInputElement>, question: QuestionContent }[] = [];
    const radioButtonGroupList: RadioButtonGroup[] = [];

    setUpQuestionTable();

    const [selectedOption, setSelectedOption] = useState&lt;SelectedContent>();
    const [questions, setQuestions] = useState&lt;QuestionContent[]>([]);
    const {loading, error, data} = useQuery(gql`
    query {
      getAllQuestions 
      {
        id
        tag
        content
        criteria_target
        criteria_application
        user_response_type
        factor
        minimize
      }
    }
    `, {client, context: {
            headers: {
                authorization: "Bearer " + cookies.token,
            },
        }});

    useEffect(() => {
        if (!loading &amp;&amp; !error &amp;&amp; data) {
            const queryContent: QuestionContent[] = data.getAllQuestions.map((question: QuestionContent) => {
                if (options &amp;&amp; !options.find((elem) => elem?.value === question.criteria_target || question.criteria_target == 'all')) {
                    options.push({
                        value: question.criteria_target, label: question.criteria_target, dbKeys: []
                    });
                }
                return {
                    id: question.id,
                    tag: question.tag,
                    content: question.content,
                    criteria_target: question.criteria_target,
                    criteria_application: question.criteria_application,
                    user_response_type: question.user_response_type,
                    factor: question.factor,
                    minimize: question.minimize
                };
            });
            setQuestions(queryContent);
        }
    }, [loading, error, data]);

    const handleChange = async (data: SelectedContent | null) => {
        if (data)
            setSelectedOption(data);
    };

    const convertResponse = (toConvert: string, type: string): string | number | boolean => {
        switch (type) {
            case 'number':
            case 'range':
                return Number(toConvert);
            case 'boolean':
                return toConvert == 'true';
            default:
                return `"${toConvert}"`;
        }
    }

    const sendToDatabase = async () => {
        const result: { question: QuestionContent, result: string }[] = [];
        htmlObjectsRef.map(object => {
            if (!object.ref.current?.value) {
                if (object.question.user_response_type == 'boolean') {
                    const radioButton = radioButtonGroupList.find(elem => elem.getName() == object.question.tag);
                    if (!radioButton) return;
                    result.push({question: object.question, result: radioButton.getSelected()});
                }
                return
            }

            const existingObjectTag = result.find(elem => elem.question.tag == object.question.tag);
            if (existingObjectTag) {
                existingObjectTag.result += `-${object.ref.current?.value}`;
            } else {
                result.push({question: object.question, result: object.ref.current?.value});
            }
        })
        let qr: DocumentNode;
        switch (selectedOption?.value) {
            case 'question':
                qr = gql(`query {
              createQuestion(
                ${['tag', 'content', 'criteria_target', 'criteria_application', 'user_response_type', 'factor', 'minimize'].map(tag => {
                    const resultQuestion = result.find(elem => elem.question.tag == tag);
                    if (!resultQuestion) return `${tag}: ""`
                    return `${tag}: ${convertResponse(resultQuestion.result, resultQuestion.question.user_response_type)}`;
                }).join('\n')}
              ), {status, content}
            }`);
                break;
            default:
                qr = gql(`query {
                  createCriteria(
                    tag: "${result.find(elem => elem.question.tag == 'tag')?.result}"
                    type: "${selectedOption?.value}"
                    additionalCriteria: [
                        ${result.map(question => {
                    return `{result: "${question.result}"
                                    question: {
                                        questionId: ${question.question.id}
                                        criteria_application: "${question.question.criteria_application}"
                                        user_response_type: "${question.question.user_response_type}"
                                        factor: ${question.question.factor}
                                        minimize: ${question.question.minimize}
                                    }}`;
                })}
                  ]), {status, content}
                }`);
                break;
        }
        client.query({
            query: qr, context: {
                headers: {
                    authorization: "Bearer " + cookies.token,
                },
            }
        });
    }

    const getInputForm = (question: QuestionContent, responseTypePart: string): JSX.Element => {
        const htmlObjectRef: RefObject&lt;HTMLInputElement> = createRef&lt;HTMLInputElement>();
        const result: JSX.Element[] = [];
        const radioButtonGroup = new RadioButtonGroup(question.tag, ['true', 'false']);
        switch (responseTypePart) {
            case 'text':
            case 'number':
                result.push(&lt;input type={responseTypePart} ref={htmlObjectRef} min={0}/>);
                htmlObjectsRef.push({ref: htmlObjectRef, question: question});
                break;
            case 'range':
                result.push(&lt;input type={responseTypePart} ref={htmlObjectRef} min={0}/>);
                htmlObjectsRef.push({ref: htmlObjectRef, question: question});
                break;
            case 'boolean':
                radioButtonGroupList.push(radioButtonGroup);
                result.push(radioButtonGroup.getRadioButtons());
                htmlObjectsRef.push({ref: htmlObjectRef, question: question});
                break;
            default:
                return &lt;p>Awaited response type: {responseTypePart} not recognized&lt;/p>
        }
        return &lt;>{result.map(object => object)}&lt;/>
    }

    const displayModificationInterface = (): JSX.Element => {
        return (&lt;>
            {selectedOption &amp;&amp; selectedOption.dbKeys.length > 0 &amp;&amp; selectedOption.dbKeys.map(questionTag => {
                const question = questions.find(elem => elem.tag == questionTag);
                if (!question) return &lt;>&lt;/>
                return &lt;>
                    &lt;p>{question.content}&lt;/p>
                    {question.user_response_type.split('-').map(responseTypePart => {
                        return getInputForm(question, responseTypePart);
                    })}
                &lt;/>
            })}
            {selectedOption &amp;&amp; selectedOption.dbKeys.length == 0 &amp;&amp; questions.filter(elem => elem.criteria_target == selectedOption?.value || elem.criteria_target == 'all').map(question => {
                return &lt;>
                    &lt;p>{question.content}&lt;/p>
                    {question.user_response_type.split('-').map(responseTypePart => {
                        return getInputForm(question, responseTypePart);
                    })}
                &lt;/>
            })}
            &lt;button onClick={() => {
                sendToDatabase();
                setSelectedOption(undefined);
            }}>Submit
            &lt;/button>
        &lt;/>);
    }

    return (&lt;>
        {!selectedOption &amp;&amp; &lt;>
            &lt;p>Selectionner ce que vous voulez ajouter: &lt;/p>
            &lt;Select options={options} value={selectedOption}
                    onChange={data => handleChange(data)}/>
        &lt;/>}
        &lt;div className='center-container'>
            {selectedOption &amp;&amp; &lt;>
                &lt;p>Selecting&lt;/p>
                &lt;Select options={options} value={selectedOption} onChange={data => handleChange(data)}/>
            &lt;/>}
            {selectedOption &amp;&amp; displayModificationInterface()}
        &lt;/div>
    &lt;/>);
}

export default ModifyLocalScoreDataPage;</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
